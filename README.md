# 关于RISC-V你所需要知道的一切

当人们在谈论RISC-V的时候，实际在谈些什么？本书尝试告诉您答案。

本书计划采用众包的方式完成，欢迎RISC-V的爱好者贡献自己的力量，以推动RISC-V在中国的普及，同时共同学习进步。

[![](/assets/import.png)](https://creativecommons.org/licenses/by-nc-sa/3.0/cn/)

本作品采用[知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议](https://creativecommons.org/licenses/by-nc-sa/3.0/cn/)进行许可。

**待讨论大纲（以下是囿于我的见识列出的大纲草稿，有很多不完善地方，大家多讨论）：**

# 第一章 RISC-V产生的时代背景

## 1 计算机体系结构
介绍计算机体系结构的发展史。介绍冯诺伊曼体系，哈弗体系，摩尔定律，单核有序，到单核乱序，到多核，单核多线程，VLWI, Vector, GPU, DSP等等。这些是背景知识，提供基本历史和技术的上下文。

## 2 计算机软件的发展
介绍汇编的意义（硬件软件的接口），C语言与静态编译器，Basic等等脚本用的解释编译器，函数式语言，面向对象语言，静态类型分析，动态类型分析，自动类型推断，JIT。这些是计算机语言的发展历史，为下一章解释RISC-V ISA的某些指令和扩展指令集做铺垫。

操作系统的发展，从无操作系统，非抢断式系统，抢断式系统，多用户系统。windows，Unix额Linux还有Mac OS的互相关系。还可以讲一讲binary translation，1类和2类virutal machine， hypervisor， micro-kernel。

> leishangwen:<br>
> 我觉得这一块没有必要讲太多，只要讲清ISA的产生背景及其意义就可以了，<br>
> 另外可以介绍一下历史上有名的、目前正在应用的一些指令集架构<br>
> 所以，我觉得这一节标题可以改为指令集的发展

## 3 硬件开发的变迁
介绍从最开始的晶体管，到CMOS，到基于标准单元的版定制流程，自动综合和布局布线，物理综合，仿真，前仿和后仿，LVS和formal verification，最终到SystemVerilog的verification特性和HSL的出现。这张的目的是给不理解硬件设计的读者入个门。后面讲到Rocket的某些硬件优化的时候会有好处。

## 4 开源运动
这有三个方面：开源软件，发生的原因和意义，现在的广泛使用，现在的问题：License的斗争，开发缓慢的问题，分支严重的问题，patent的问题，难以商业化不挣钱的问题。
> leishangwen:<br>
> 是不是应该多讲讲软件开源的好处和成功之处，linux的成功是不是也是由于其是开源的？<br>
> 目的是借鉴软件开源的成功经验，从而预期硬件开源的未来

开源硬件，早已出现，OpenRISC，为何不成功：开发人员少群众基础不够，项目多数未完成，完成的也缺少验证，难以流片验证，缺少开源工具链，模拟设计难以开源，开源设计难以流片的各种实际因素。当然也说现在已有的成果，开源模拟器，简单的开源逻辑综合器，开源的硬件设计等等。
> leishangwen:<br>
> 建议在这里介绍一下开源硬件（主要是开源处理器）的现状

指令及开源：指令级本身对性能影响其实不大，但是一个指令级所附带的生态环境非常重要。选用一个指令级其实是选择了一个生态环境，为这个生态环境付费。开源指令集的主要目的其实是提供一个开源的生态环境，包括ISA, 编译器，操作系统，软件库等等。



# 第二章 RISC-V

这一章就讲RISC-V指令级

## 1 RISC-V的历史
介绍UCB, MIPS, RISC-V的出现，开源，基金会的建立，它的目的和意义。

## 2 RISC-V的基本设计原理
介绍RV64I和RV32I的基本设计原理，可扩展的方式，面向硬件设计的编码方式，面向简单流水线设计的指令选择（不用条件执行，不用多周期指令）。

## 3 RISC-V特权指令设计
为何选择使用CSR，CSR的设计细节，不同特权级的定义，特权级之间的跳转，delegation的使用。（这里可以说的惊人细节太多了）

## 4 内存模型
介绍什么是内存模型，virtual memory的设计，和RISC-V的内存模型（这一部分快定义好了）

## 5 RISC-V的压缩指令
为什要有压缩指令及，怎么设计的，性能数据。结合压缩指令及讨论instruction fusion。简单说说压缩指令对硬件的影响，比如指令地址unalign，fetch级的动态取指速度，节省I$等等。

## 6 RISC-V的扩展指令集

AMO和LR/SC的设计意图（原子操作和关键区支持）。M/D/F/E等等已经可以用的扩展，和计划中的扩展。

> wsong83:<br>
> - 关于UCB的历史，可以看看[RISC-V Geneology](https://www2.eecs.berkeley.edu/Pubs/TechRpts/2016/EECS-2016-6.pdf)

## 7 RISC-V的软件生态
介绍围绕RISC-V开发的编译器、移植的操作系统等软件的情况。

## 8 RISC-V在产业界与学术界的现状
概述基于RISC-V指令集的处理器、SoC，并进行简单地汇总统计。


# 第四章 Chisel简介

简单介绍Chisel3.0的原理、优势、相关知识点。（lsl之前整理过Chisel2.0版本的资料）

> 我们估计讲不了原理吧。
> 优势可以稍微举举例子。但是把这一本摊开讲基本就是一本书。
> 这一部分只能是稍微介绍。我甚至觉得这一章应该变成Rocket-chip的一节。其实只有Rocket-chip使用Chisel。其他所有的设计都不用。
>
> leishangwen：<br>
> 这里的原理指的是简单原理，在chisel到fir到verilog的大概过程<br>
> 优势也是简单提一下，包括直接得到模拟器等<br>
> 同意将这一章与第五章合并<br>

# 第五章 Rocket-Chip概述

包括Rocket-Chip概述，包括产生的目的、各个文件夹的作用、Rocket-Chip的作用、结构图、使用方法等；此外，介绍广泛使用的Tilelink的协议内容，以及简单介绍Chisel3.0的原理、优势、相关知识点，（这里的原理指的是简单原理，在chisel到fir到verilog的大概过程）

> TileLink 并没有被广泛运用吧，基本就是UCB和SiFive的内部总线协议和实现。可以稍微介绍一下。
> 仍然觉得先讲Rocket-chip再说Rocket-core行不通吧。这两个基本是息息相关啊。
>
> leishangwen：<br>
> TileLink在Rocket-chip内部大量使用，如果想了解Rocket-Chip代码，TileLink是绕不过去的，但是资料比较<br>
> 少，也只能简单介绍一下，说清楚基本的消息就行了<br>
> 本章的目的是介绍Rocket-Chip，是概述，在下面的章节中详细介绍Rocket-Chip的几个成果，包括Rocket、boom、lowrisc等，所以我将Rocket-Chip放在Rocket-core之前讲<br>


# 第六章 Rocket处理器

大概分三个部分：

第一部分包括性能参数、结构框图、接口图、各个文件的作用，实验环境搭建，仿真步骤，实验步骤（包括下载到开发板的步骤）；

> 使用Rocket-core的开发板并没有统一吧，除非你是专指SiFive的板子。作为lowRISC，我们支持Nexys4-DDR。UCB也曾经支持过多款Zynq的板子。
> 我的主要意见是，讲这些对读者有多少帮助。我觉得我们应该避免把自己知道的东西去堆成一本书，而应该想想些什么东西是对以后有用的，可以作为知识去指导实践的。
> 有些东西讲细了，就变成英文文档的翻译。一旦别人的文档变了，书就没用了。
>
> leishangwen:<br>
> 同意宋同学的意见，多讲特性、结构、内部工作机理、参数化使用等，包括第七章的boom也是如此<br>
> 但是对于freedom系列，还是要讲试验，因为freedom e310已经流片了，是一款相对稳定的产品了<br>

第二部分介绍RoCC的相关知识，包括机制、使用方法、测试等（lsl之前积累过这方面的资料）；

> 要小心。ROCC接口本身就从没稳定过。
>
> leishangwen:<br>
> 在邮件里经常有RoCC的邮件，所以我觉得这个的关注度还是蛮高的，当然目前RoCC只能在特定的版本使用，<br>
> 在写的时候要注明<br>

第三部分介绍多核配置、仿真、下载试验的步骤。

> 一样，有点觉得这些不该是一本书的内容。给出链接指向SiFive的正确网页即可。
> 当然，有些逻辑上的东西是有意义的，比如说什么结构是可以配置的，为什么这么配。
> 举个例子子，陪scratch pad和nonblocking L1 D$就是互相矛盾的。
>
> leishangwen:<br>
> 关于多核，可以结合试验，介绍一下多核的结构，包括缓存一致性等关键技术<br>
> 另外，我还是觉得这里的多核试验可以保留，理由有两点<br>
> 1、有一点试验，可操作的内容，对于读者来说不显得太过于枯燥<br>
> 2、多核配置试验可以结合试验，分析内部工作流程，比如：结合试验，分析缓存一致性的实现原理等。<br>

# 第七章 BOOM处理器

包括性能参数、结构框图、接口图、各个文件的作用，仿真步骤，实验步骤（包括下载到开发板的步骤）；

# 第八章 SiFive公司的Freedom系列

大概分为五个部分：

第一部分介绍SiFive公司及其Freedom系列的基本情况（lsl之前积累过这方面的资料）；

第二部分介绍Freedom E310的性能参数、结构框图、接口图、各个文件的作用，仿真步骤，实验环境搭建，实验步骤（包括下载到开发板的步骤）；

第三部分分析Freedom E310的移植到Altera的步骤、调试环境建设（lsl之前积累过这方面的资料）。

第四部分从代码分析调试原理（lsl之前积累过这方面的资料）；

第五部分介绍HiFive的基本情况，实验环境搭建，实验步骤，试验例程分析，ucosII的移植。

# 第九章 LowRISC

包括LowRISC的产生原因、发展历史、相比Rocket的主要改进点，仿真步骤，实验环境搭建，实验步骤（包括下载到开发板的步骤）；
> leishangwen：<br>
> lowrisc这一部分需要宋同学多费心了，建议多讲特性、结构、内部工作机理、参数化使用等<br>
> 另外，建议结合试验或者仿真，可以更好地讲解lowrisc的一些特性，比如tagged memory等<br>
> 所以，这里的试验不是简单地试验，不是按照网站的说明，一步步操作，而是要结合内容自己设计试验<br>

# 第十章 RISCV-mini源代码分析

分析RISCV-mini或者sodo、zscala的源代码，以小见大，而且因为简单便于大家理解（lsl之前积累过sodor源代码的相关的资料）

